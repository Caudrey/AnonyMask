<!-- Processing Popup -->
<div class="overlay" *ngIf="isGenerating">
  <div class="popup">
    <span class="spinner"></span>
    <p>🔄 Processing unmasking, please wait...</p>
  </div>
</div>
<div class="wrapper">
  <h2 class="title">🔍 Unmasking System</h2>

  <div class="upload-box">
    <div class="upload-group">
      <!-- <div class="upload-item">
        <label>📁 Original File</label>
        <input type="file" (change)="uploadOriginal($event)" />
        <span *ngIf="originalFileName">✅ {{ originalFileName }}</span>
      </div>

      <div class="upload-item">
        <label>🕵️ Masked File</label>
        <input type="file" (change)="uploadMasked($event)" />
        <span *ngIf="maskedFileName">✅ {{ maskedFileName }}</span>
      </div> -->

      <div class="upload-item">
        <label>🧠 Masking Log (JSON)</label>
        <input type="file" (change)="uploadUnmaskingJson($event)" accept=".json" />
        <span *ngIf="maskedMapping.length">✅ {{ processedMaskedFileName }}</span>
      </div>

      <div class="upload-item">
        <label>🧩 Processed File</label>
        <input type="file" (change)="uploadProcessedMasked($event)" />
        <span *ngIf="processedMaskedFileName">✅ {{ processedMaskedFileName }}</span>
      </div>
    </div>

    <div class="download-group">
      <button
        class="download-button"
        [disabled]="!fileReady || isGenerating"
        (click)="onDownload()"
      >
        ⬇ Download Unmasked File
      </button>
    </div>
  </div>

  <div *ngIf="isGenerating" class="status-text">
    🔄 Processing unmasking, please wait...
  </div>

<!-- <div *ngIf="fileReady" class="preview-box">
  <h3 class="preview-title">Option A: Clean Layout</h3>
  <div class="grid-cols">
    <div>
      <h4>📄 Original File</h4>
      <div class="text-preview">
        <ng-container *ngFor="let token of originalTokensWithDiff">
          <span [ngClass]="{ 'highlight-original': token.changed }">{{ token.word }}</span>&nbsp;
        </ng-container>
      </div>
    </div>
    <div>
      <h4>🛡️ Masked Output</h4>
      <div class="text-preview">
        <ng-container *ngFor="let token of maskedTokensWithDiff">
          <span [ngClass]="{ 'highlight-masked': token.changed }">{{ token.word }}</span>&nbsp;
        </ng-container>
      </div>
    </div>
  </div>
  </div> -->

    <!-- ⬇️ MAPPING TABLE TAMPIL SETELAH FILES DAN PREVIEW ADA -->
    <div *ngIf="maskedMapping.length > 0" class="mapping-table-box" class="preview-box">
      <h3 class="preview-title">📋 Masking Word Mapping</h3>
      <table class="mapping-table">
        <thead>
          <tr>
            <th>🧾 Original Word</th>
            <th>🕵️ Masked Word</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of maskedMapping">
            <td>{{ item.original }}</td>
            <td>{{ item.masked }}</td>
          </tr>
        </tbody>
      </table>
    </div>

  <div *ngIf="fileReady" class="preview-box">
  <h3 class="preview-title">Result Comparison</h3>
  <div class="grid-cols preview-row">
    <div>
      <h4>🧩 Processed File</h4>
      <div class="text-preview" [innerHTML]="processedHighlightedContent"></div>
    </div>
    <div>
      <h4>🔓 Unmasked Result</h4>
      <div class="text-preview" [innerHTML]="resultHighlightedContent"></div>
    </div>
  </div>
  </div>



  <div *ngIf="resultContent" class="preview-box">
    <h3 class="preview-title">🔓 Unmasked Result Preview:</h3>
    <pre>{{ resultContent }}</pre>
  </div>
</div>
